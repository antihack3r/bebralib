/*
 * This file is a part of bebralib -- you can get yo copy at https://github.com/antihack3r/bebralib
 */

package ru.antihack3r.bebralib.run;

import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.net.URL;
import java.net.URLClassLoader;

public class Reflector {
	
	public static Method getDeclaredMethod(Class<?> clazz, String methodName, Class<?>... argTypes) {
		try {
			return clazz.getDeclaredMethod(methodName, argTypes);
		} catch (NoSuchMethodException e) {
			return null;
		}
	}
	
	public static Class<?>[] getTypes(Object... args) {
		Class<?>[] argTypes = new Class[args.length];
		int counter = 0;
		for (Object arg: args) {
			argTypes[counter] = arg.getClass();
			counter += 1;
		}
		
		return argTypes;
	}
	
	// TODO: clean this mess up and make it an actual API
	public static void main(String[] args) {
		byte[] rawData = {
				(byte)0xCA, (byte)0xFE, (byte)0xBA, (byte)0xBE, (byte)0x00, (byte)0x00,
				(byte)0x00, (byte)0x34, (byte)0x00, (byte)0x3B, (byte)0x0A, (byte)0x00,
				(byte)0x0B, (byte)0x00, (byte)0x1C, (byte)0x09, (byte)0x00, (byte)0x1D,
				(byte)0x00, (byte)0x1E, (byte)0x07, (byte)0x00, (byte)0x1F, (byte)0x0A,
				(byte)0x00, (byte)0x09, (byte)0x00, (byte)0x20, (byte)0x0A, (byte)0x00,
				(byte)0x21, (byte)0x00, (byte)0x22, (byte)0x08, (byte)0x00, (byte)0x23,
				(byte)0x0A, (byte)0x00, (byte)0x09, (byte)0x00, (byte)0x24, (byte)0x08,
				(byte)0x00, (byte)0x25, (byte)0x07, (byte)0x00, (byte)0x26, (byte)0x0A,
				(byte)0x00, (byte)0x09, (byte)0x00, (byte)0x27, (byte)0x07, (byte)0x00,
				(byte)0x28, (byte)0x0A, (byte)0x00, (byte)0x29, (byte)0x00, (byte)0x2A,
				(byte)0x01, (byte)0x00, (byte)0x06, (byte)0x3C, (byte)0x69, (byte)0x6E,
				(byte)0x69, (byte)0x74, (byte)0x3E, (byte)0x01, (byte)0x00, (byte)0x03,
				(byte)0x28, (byte)0x29, (byte)0x56, (byte)0x01, (byte)0x00, (byte)0x04,
				(byte)0x43, (byte)0x6F, (byte)0x64, (byte)0x65, (byte)0x01, (byte)0x00,
				(byte)0x0F, (byte)0x4C, (byte)0x69, (byte)0x6E, (byte)0x65, (byte)0x4E,
				(byte)0x75, (byte)0x6D, (byte)0x62, (byte)0x65, (byte)0x72, (byte)0x54,
				(byte)0x61, (byte)0x62, (byte)0x6C, (byte)0x65, (byte)0x01, (byte)0x00,
				(byte)0x12, (byte)0x4C, (byte)0x6F, (byte)0x63, (byte)0x61, (byte)0x6C,
				(byte)0x56, (byte)0x61, (byte)0x72, (byte)0x69, (byte)0x61, (byte)0x62,
				(byte)0x6C, (byte)0x65, (byte)0x54, (byte)0x61, (byte)0x62, (byte)0x6C,
				(byte)0x65, (byte)0x01, (byte)0x00, (byte)0x04, (byte)0x74, (byte)0x68,
				(byte)0x69, (byte)0x73, (byte)0x01, (byte)0x00, (byte)0x11, (byte)0x4C,
				(byte)0x42, (byte)0x79, (byte)0x74, (byte)0x65, (byte)0x63, (byte)0x6F,
				(byte)0x64, (byte)0x65, (byte)0x46, (byte)0x75, (byte)0x63, (byte)0x6B,
				(byte)0x65, (byte)0x72, (byte)0x79, (byte)0x3B, (byte)0x01, (byte)0x00,
				(byte)0x04, (byte)0x6D, (byte)0x61, (byte)0x69, (byte)0x6E, (byte)0x01,
				(byte)0x00, (byte)0x16, (byte)0x28, (byte)0x5B, (byte)0x4C, (byte)0x6A,
				(byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61,
				(byte)0x6E, (byte)0x67, (byte)0x2F, (byte)0x53, (byte)0x74, (byte)0x72,
				(byte)0x69, (byte)0x6E, (byte)0x67, (byte)0x3B, (byte)0x29, (byte)0x56,
				(byte)0x01, (byte)0x00, (byte)0x04, (byte)0x61, (byte)0x72, (byte)0x67,
				(byte)0x73, (byte)0x01, (byte)0x00, (byte)0x13, (byte)0x5B, (byte)0x4C,
				(byte)0x6A, (byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C,
				(byte)0x61, (byte)0x6E, (byte)0x67, (byte)0x2F, (byte)0x53, (byte)0x74,
				(byte)0x72, (byte)0x69, (byte)0x6E, (byte)0x67, (byte)0x3B, (byte)0x01,
				(byte)0x00, (byte)0x0A, (byte)0x45, (byte)0x78, (byte)0x63, (byte)0x65,
				(byte)0x70, (byte)0x74, (byte)0x69, (byte)0x6F, (byte)0x6E, (byte)0x73,
				(byte)0x07, (byte)0x00, (byte)0x2B, (byte)0x01, (byte)0x00, (byte)0x0A,
				(byte)0x53, (byte)0x6F, (byte)0x75, (byte)0x72, (byte)0x63, (byte)0x65,
				(byte)0x46, (byte)0x69, (byte)0x6C, (byte)0x65, (byte)0x01, (byte)0x00,
				(byte)0x14, (byte)0x42, (byte)0x79, (byte)0x74, (byte)0x65, (byte)0x63,
				(byte)0x6F, (byte)0x64, (byte)0x65, (byte)0x46, (byte)0x75, (byte)0x63,
				(byte)0x6B, (byte)0x65, (byte)0x72, (byte)0x79, (byte)0x2E, (byte)0x6A,
				(byte)0x61, (byte)0x76, (byte)0x61, (byte)0x0C, (byte)0x00, (byte)0x0D,
				(byte)0x00, (byte)0x0E, (byte)0x07, (byte)0x00, (byte)0x2C, (byte)0x0C,
				(byte)0x00, (byte)0x2D, (byte)0x00, (byte)0x2E, (byte)0x01, (byte)0x00,
				(byte)0x0F, (byte)0x42, (byte)0x79, (byte)0x74, (byte)0x65, (byte)0x63,
				(byte)0x6F, (byte)0x64, (byte)0x65, (byte)0x46, (byte)0x75, (byte)0x63,
				(byte)0x6B, (byte)0x65, (byte)0x72, (byte)0x79, (byte)0x0C, (byte)0x00,
				(byte)0x2F, (byte)0x00, (byte)0x30, (byte)0x07, (byte)0x00, (byte)0x31,
				(byte)0x0C, (byte)0x00, (byte)0x32, (byte)0x00, (byte)0x33, (byte)0x01,
				(byte)0x00, (byte)0x24, (byte)0x72, (byte)0x75, (byte)0x2E, (byte)0x61,
				(byte)0x6E, (byte)0x74, (byte)0x69, (byte)0x68, (byte)0x61, (byte)0x63,
				(byte)0x6B, (byte)0x33, (byte)0x72, (byte)0x2E, (byte)0x62, (byte)0x65,
				(byte)0x62, (byte)0x72, (byte)0x61, (byte)0x6C, (byte)0x69, (byte)0x62,
				(byte)0x2E, (byte)0x72, (byte)0x75, (byte)0x6E, (byte)0x2E, (byte)0x52,
				(byte)0x65, (byte)0x66, (byte)0x6C, (byte)0x65, (byte)0x63, (byte)0x74,
				(byte)0x6F, (byte)0x72, (byte)0x0C, (byte)0x00, (byte)0x34, (byte)0x00,
				(byte)0x35, (byte)0x01, (byte)0x00, (byte)0x09, (byte)0x64, (byte)0x6F,
				(byte)0x4E, (byte)0x6F, (byte)0x74, (byte)0x68, (byte)0x69, (byte)0x6E,
				(byte)0x67, (byte)0x01, (byte)0x00, (byte)0x0F, (byte)0x6A, (byte)0x61,
				(byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E,
				(byte)0x67, (byte)0x2F, (byte)0x43, (byte)0x6C, (byte)0x61, (byte)0x73,
				(byte)0x73, (byte)0x0C, (byte)0x00, (byte)0x36, (byte)0x00, (byte)0x37,
				(byte)0x01, (byte)0x00, (byte)0x10, (byte)0x6A, (byte)0x61, (byte)0x76,
				(byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E, (byte)0x67,
				(byte)0x2F, (byte)0x4F, (byte)0x62, (byte)0x6A, (byte)0x65, (byte)0x63,
				(byte)0x74, (byte)0x07, (byte)0x00, (byte)0x38, (byte)0x0C, (byte)0x00,
				(byte)0x39, (byte)0x00, (byte)0x3A, (byte)0x01, (byte)0x00, (byte)0x13,
				(byte)0x6A, (byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C,
				(byte)0x61, (byte)0x6E, (byte)0x67, (byte)0x2F, (byte)0x54, (byte)0x68,
				(byte)0x72, (byte)0x6F, (byte)0x77, (byte)0x61, (byte)0x62, (byte)0x6C,
				(byte)0x65, (byte)0x01, (byte)0x00, (byte)0x10, (byte)0x6A, (byte)0x61,
				(byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E,
				(byte)0x67, (byte)0x2F, (byte)0x53, (byte)0x79, (byte)0x73, (byte)0x74,
				(byte)0x65, (byte)0x6D, (byte)0x01, (byte)0x00, (byte)0x03, (byte)0x6F,
				(byte)0x75, (byte)0x74, (byte)0x01, (byte)0x00, (byte)0x15, (byte)0x4C,
				(byte)0x6A, (byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x69,
				(byte)0x6F, (byte)0x2F, (byte)0x50, (byte)0x72, (byte)0x69, (byte)0x6E,
				(byte)0x74, (byte)0x53, (byte)0x74, (byte)0x72, (byte)0x65, (byte)0x61,
				(byte)0x6D, (byte)0x3B, (byte)0x01, (byte)0x00, (byte)0x07, (byte)0x67,
				(byte)0x65, (byte)0x74, (byte)0x4E, (byte)0x61, (byte)0x6D, (byte)0x65,
				(byte)0x01, (byte)0x00, (byte)0x14, (byte)0x28, (byte)0x29, (byte)0x4C,
				(byte)0x6A, (byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C,
				(byte)0x61, (byte)0x6E, (byte)0x67, (byte)0x2F, (byte)0x53, (byte)0x74,
				(byte)0x72, (byte)0x69, (byte)0x6E, (byte)0x67, (byte)0x3B, (byte)0x01,
				(byte)0x00, (byte)0x13, (byte)0x6A, (byte)0x61, (byte)0x76, (byte)0x61,
				(byte)0x2F, (byte)0x69, (byte)0x6F, (byte)0x2F, (byte)0x50, (byte)0x72,
				(byte)0x69, (byte)0x6E, (byte)0x74, (byte)0x53, (byte)0x74, (byte)0x72,
				(byte)0x65, (byte)0x61, (byte)0x6D, (byte)0x01, (byte)0x00, (byte)0x07,
				(byte)0x70, (byte)0x72, (byte)0x69, (byte)0x6E, (byte)0x74, (byte)0x6C,
				(byte)0x6E, (byte)0x01, (byte)0x00, (byte)0x15, (byte)0x28, (byte)0x4C,
				(byte)0x6A, (byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C,
				(byte)0x61, (byte)0x6E, (byte)0x67, (byte)0x2F, (byte)0x53, (byte)0x74,
				(byte)0x72, (byte)0x69, (byte)0x6E, (byte)0x67, (byte)0x3B, (byte)0x29,
				(byte)0x56, (byte)0x01, (byte)0x00, (byte)0x07, (byte)0x66, (byte)0x6F,
				(byte)0x72, (byte)0x4E, (byte)0x61, (byte)0x6D, (byte)0x65, (byte)0x01,
				(byte)0x00, (byte)0x25, (byte)0x28, (byte)0x4C, (byte)0x6A, (byte)0x61,
				(byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E,
				(byte)0x67, (byte)0x2F, (byte)0x53, (byte)0x74, (byte)0x72, (byte)0x69,
				(byte)0x6E, (byte)0x67, (byte)0x3B, (byte)0x29, (byte)0x4C, (byte)0x6A,
				(byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61,
				(byte)0x6E, (byte)0x67, (byte)0x2F, (byte)0x43, (byte)0x6C, (byte)0x61,
				(byte)0x73, (byte)0x73, (byte)0x3B, (byte)0x01, (byte)0x00, (byte)0x09,
				(byte)0x67, (byte)0x65, (byte)0x74, (byte)0x4D, (byte)0x65, (byte)0x74,
				(byte)0x68, (byte)0x6F, (byte)0x64, (byte)0x01, (byte)0x00, (byte)0x40,
				(byte)0x28, (byte)0x4C, (byte)0x6A, (byte)0x61, (byte)0x76, (byte)0x61,
				(byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E, (byte)0x67, (byte)0x2F,
				(byte)0x53, (byte)0x74, (byte)0x72, (byte)0x69, (byte)0x6E, (byte)0x67,
				(byte)0x3B, (byte)0x5B, (byte)0x4C, (byte)0x6A, (byte)0x61, (byte)0x76,
				(byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E, (byte)0x67,
				(byte)0x2F, (byte)0x43, (byte)0x6C, (byte)0x61, (byte)0x73, (byte)0x73,
				(byte)0x3B, (byte)0x29, (byte)0x4C, (byte)0x6A, (byte)0x61, (byte)0x76,
				(byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E, (byte)0x67,
				(byte)0x2F, (byte)0x72, (byte)0x65, (byte)0x66, (byte)0x6C, (byte)0x65,
				(byte)0x63, (byte)0x74, (byte)0x2F, (byte)0x4D, (byte)0x65, (byte)0x74,
				(byte)0x68, (byte)0x6F, (byte)0x64, (byte)0x3B, (byte)0x01, (byte)0x00,
				(byte)0x18, (byte)0x6A, (byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F,
				(byte)0x6C, (byte)0x61, (byte)0x6E, (byte)0x67, (byte)0x2F, (byte)0x72,
				(byte)0x65, (byte)0x66, (byte)0x6C, (byte)0x65, (byte)0x63, (byte)0x74,
				(byte)0x2F, (byte)0x4D, (byte)0x65, (byte)0x74, (byte)0x68, (byte)0x6F,
				(byte)0x64, (byte)0x01, (byte)0x00, (byte)0x06, (byte)0x69, (byte)0x6E,
				(byte)0x76, (byte)0x6F, (byte)0x6B, (byte)0x65, (byte)0x01, (byte)0x00,
				(byte)0x39, (byte)0x28, (byte)0x4C, (byte)0x6A, (byte)0x61, (byte)0x76,
				(byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E, (byte)0x67,
				(byte)0x2F, (byte)0x4F, (byte)0x62, (byte)0x6A, (byte)0x65, (byte)0x63,
				(byte)0x74, (byte)0x3B, (byte)0x5B, (byte)0x4C, (byte)0x6A, (byte)0x61,
				(byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61, (byte)0x6E,
				(byte)0x67, (byte)0x2F, (byte)0x4F, (byte)0x62, (byte)0x6A, (byte)0x65,
				(byte)0x63, (byte)0x74, (byte)0x3B, (byte)0x29, (byte)0x4C, (byte)0x6A,
				(byte)0x61, (byte)0x76, (byte)0x61, (byte)0x2F, (byte)0x6C, (byte)0x61,
				(byte)0x6E, (byte)0x67, (byte)0x2F, (byte)0x4F, (byte)0x62, (byte)0x6A,
				(byte)0x65, (byte)0x63, (byte)0x74, (byte)0x3B, (byte)0x00, (byte)0x21,
				(byte)0x00, (byte)0x03, (byte)0x00, (byte)0x0B, (byte)0x00, (byte)0x00,
				(byte)0x00, (byte)0x00, (byte)0x00, (byte)0x02, (byte)0x00, (byte)0x01,
				(byte)0x00, (byte)0x0D, (byte)0x00, (byte)0x0E, (byte)0x00, (byte)0x01,
				(byte)0x00, (byte)0x0F, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x2F,
				(byte)0x00, (byte)0x01, (byte)0x00, (byte)0x01, (byte)0x00, (byte)0x00,
				(byte)0x00, (byte)0x05, (byte)0x2A, (byte)0xB7, (byte)0x00, (byte)0x01,
				(byte)0xB1, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x02, (byte)0x00,
				(byte)0x10, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x06, (byte)0x00,
				(byte)0x01, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x01, (byte)0x00,
				(byte)0x11, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x0C, (byte)0x00,
				(byte)0x01, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x05, (byte)0x00,
				(byte)0x12, (byte)0x00, (byte)0x13, (byte)0x00, (byte)0x00, (byte)0x00,
				(byte)0x09, (byte)0x00, (byte)0x14, (byte)0x00, (byte)0x15, (byte)0x00,
				(byte)0x02, (byte)0x00, (byte)0x0F, (byte)0x00, (byte)0x00, (byte)0x00,
				(byte)0x55, (byte)0x00, (byte)0x03, (byte)0x00, (byte)0x01, (byte)0x00,
				(byte)0x00, (byte)0x00, (byte)0x23, (byte)0xB2, (byte)0x00, (byte)0x02,
				(byte)0x12, (byte)0x03, (byte)0xB6, (byte)0x00, (byte)0x04, (byte)0xB6,
				(byte)0x00, (byte)0x05, (byte)0x12, (byte)0x06, (byte)0xB8, (byte)0x00,
				(byte)0x07, (byte)0x12, (byte)0x08, (byte)0x03, (byte)0xBD, (byte)0x00,
				(byte)0x09, (byte)0xB6, (byte)0x00, (byte)0x0A, (byte)0x01, (byte)0x03,
				(byte)0xBD, (byte)0x00, (byte)0x0B, (byte)0xB6, (byte)0x00, (byte)0x0C,
				(byte)0x57, (byte)0xB1, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x02,
				(byte)0x00, (byte)0x10, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x0E,
				(byte)0x00, (byte)0x03, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x04,
				(byte)0x00, (byte)0x0B, (byte)0x00, (byte)0x05, (byte)0x00, (byte)0x22,
				(byte)0x00, (byte)0x06, (byte)0x00, (byte)0x11, (byte)0x00, (byte)0x00,
				(byte)0x00, (byte)0x0C, (byte)0x00, (byte)0x01, (byte)0x00, (byte)0x00,
				(byte)0x00, (byte)0x23, (byte)0x00, (byte)0x16, (byte)0x00, (byte)0x17,
				(byte)0x00, (byte)0x00, (byte)0x00, (byte)0x18, (byte)0x00, (byte)0x00,
				(byte)0x00, (byte)0x04, (byte)0x00, (byte)0x01, (byte)0x00, (byte)0x19,
				(byte)0x00, (byte)0x01, (byte)0x00, (byte)0x1A, (byte)0x00, (byte)0x00,
				(byte)0x00, (byte)0x02, (byte)0x00, (byte)0x1B
		};
		
		try (ByteClassLoader bcl = new ByteClassLoader()) {
			Class<?> clazz = bcl.def(rawData);
			clazz.getMethod("main", String[].class).invoke(null, (Object)new String[0]);
		} catch (NoSuchMethodException | IOException | InvocationTargetException | IllegalAccessException e) {
			throw new RuntimeException(e);
		}
	}
	
	public static class ByteClassLoader extends URLClassLoader {
		
		public ByteClassLoader() {
			super(new URL[0], ByteClassLoader.class.getClassLoader());
		}
		
		public Class<?> def(byte[] bytes) {
			Class<?> clazz = defineClass(null, bytes, 0, bytes.length);
			resolveClass(clazz);
			return clazz;
		}
		
	}
	
}
